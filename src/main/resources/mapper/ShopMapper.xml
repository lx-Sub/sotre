<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rabbiter.hrm.mapper.ShopMapper">

    <resultMap id="BaseResultMap" type="com.rabbiter.hrm.entity.Shop">
        <id column="id" property="id"/>
        <result column="merchant_id" property="merchantId"/>
        <result column="shop_name" property="shopName"/>
        <result column="shop_logo" property="shopLogo"/>
        <result column="shop_banner" property="shopBanner"/>
        <result column="shop_desc" property="shopDesc"/>
        <result column="shop_address" property="shopAddress"/>
        <result column="contact_phone" property="contactPhone"/>
        <result column="contact_email" property="contactEmail"/>
        <result column="business_license" property="businessLicense"/>
        <result column="brand_authorization" property="brandAuthorization"/>
        <result column="audit_status" property="auditStatus"/>
        <result column="audit_remark" property="auditRemark"/>
        <result column="audit_time" property="auditTime"/>
        <result column="status" property="status"/>
        <result column="score" property="score"/>
        <result column="sale_count" property="saleCount"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, merchant_id, shop_name, shop_logo, shop_banner, shop_desc, shop_address,
        contact_phone, contact_email, business_license, brand_authorization,
        audit_status, audit_remark, audit_time, status, score, sale_count,
        create_time, update_time
    </sql>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM shop
        WHERE id = #{id}
    </select>

    <select id="selectByMerchantId" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM shop
        WHERE merchant_id = #{merchantId}
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO shop (
            merchant_id, shop_name, shop_logo, shop_banner, shop_desc,
            shop_address, contact_phone, contact_email, business_license,
            brand_authorization, audit_status, status, create_time
        ) VALUES (
            #{merchantId}, #{shopName}, #{shopLogo}, #{shopBanner}, #{shopDesc},
            #{shopAddress}, #{contactPhone}, #{contactEmail}, #{businessLicense},
            #{brandAuthorization}, #{auditStatus}, #{status}, NOW()
        )
    </insert>

    <update id="updateById">
        UPDATE shop
        <set>
            <if test="shopName != null">shop_name = #{shopName},</if>
            <if test="shopLogo != null">shop_logo = #{shopLogo},</if>
            <if test="shopBanner != null">shop_banner = #{shopBanner},</if>
            <if test="shopDesc != null">shop_desc = #{shopDesc},</if>
            <if test="shopAddress != null">shop_address = #{shopAddress},</if>
            <if test="contactPhone != null">contact_phone = #{contactPhone},</if>
            <if test="contactEmail != null">contact_email = #{contactEmail},</if>
            <if test="status != null">status = #{status},</if>
            <if test="score != null">score = #{score},</if>
            <if test="saleCount != null">sale_count = #{saleCount},</if>
            update_time = NOW()
        </set>
        WHERE id = #{id}
    </update>

    <update id="updateAuditStatus">
        UPDATE shop
        SET audit_status = #{auditStatus},
            audit_remark = #{auditRemark},
            audit_time = #{auditTime},
            update_time = NOW()
        WHERE id = #{id}
    </update>

    <update id="updateStatus">
        UPDATE shop
        SET status = #{status},
            update_time = NOW()
        WHERE id = #{id}
    </update>

</mapper>